import{i as n,p as a,g as i}from"./watch-later-DSiUGnA7.js";async function g(s){if(!n)return{notes:[],bookmarks:[],progress:a(s)};try{const r=i(),[o,t,e]=await Promise.all([r.notes.where("videoId").equals(s).toArray(),r.bookmarks.where("videoId").equals(s).toArray(),r.videoProgress.get(s)]);return{notes:o||[],bookmarks:t||[],progress:e||a(s)}}catch(r){return console.error("Error loading video study data:",r),{notes:[],bookmarks:[],progress:a(s)}}}async function u(s,r){if(n)try{const o=i();await o.transaction("rw",[o.notes,o.bookmarks,o.videoProgress],async()=>{if(await o.notes.where("videoId").equals(s).delete(),await o.bookmarks.where("videoId").equals(s).delete(),r.notes.length>0){const t=r.notes.map(e=>({...e,videoId:s}));await o.notes.bulkPut(t)}if(r.bookmarks.length>0){const t=r.bookmarks.map(e=>({...e,videoId:s}));await o.bookmarks.bulkPut(t)}await o.videoProgress.put({...r.progress,videoId:s})})}catch(o){console.error("Error saving video study data:",o)}}async function k(s){if(!n)return 0;try{return(await i().videoProgress.get(s))?.lastPosition||0}catch{return 0}}async function l(s,r){if(n)try{const o=i(),t=await o.videoProgress.get(s);await o.videoProgress.put({...t||a(s),videoId:s,lastPosition:r,lastWatched:new Date().toISOString()})}catch(o){console.error("Error saving video position:",o)}}export{l as a,k as g,g as l,u as s};
