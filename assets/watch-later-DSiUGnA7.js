import{D as u}from"./main-Dql0iJJ5.js";const a=typeof window<"u";class f extends u{notes;bookmarks;videoProgress;favorites;watchLater;sessions;streak;settings;constructor(){super("StudyDatabase"),this.version(1).stores({notes:"id, videoId, createdAt, importance, *tags",bookmarks:"id, videoId, createdAt",videoProgress:"videoId, completed, lastWatched, watchedPercentage",favorites:"videoId, addedAt",watchLater:"videoId, addedAt, priority",sessions:"id, videoId, startTime, endTime",streak:"id",settings:"id"})}}let s=null;function n(){if(!a)throw new Error("Database can only be accessed in the browser");return s||(s=new f,s.on("populate",()=>{s?.settings.add({id:"main",pomodoroLength:25,breakLength:5,autoResumeEnabled:!0,keyboardShortcutsEnabled:!0,defaultPlaybackSpeed:1,totalWatchTime:0}),s?.streak.add({id:"main",currentStreak:0,longestStreak:0,lastStudyDate:"",studyDates:[]})})),s}function h(){return Date.now().toString(36)+Math.random().toString(36).substr(2)}function g(){return new Date().toISOString().split("T")[0]}function m(){return{id:"main",pomodoroLength:25,breakLength:5,autoResumeEnabled:!0,keyboardShortcutsEnabled:!0,defaultPlaybackSpeed:1,totalWatchTime:0}}function y(){return{id:"main",currentStreak:0,longestStreak:0,lastStudyDate:"",studyDates:[]}}function w(t){return{videoId:t,completed:!1,lastWatched:new Date().toISOString(),watchedPercentage:0,rating:0}}function D(t){const e=Math.floor(t/3600),r=Math.floor(t%3600/60);return e>0?`${e} ساعة ${r>0?`و ${r} دقيقة`:""}`:`${r} دقيقة`}function b(t){const e=new Date(t),o=new Date().getTime()-e.getTime(),i=Math.floor(o/6e4),c=Math.floor(o/36e5),d=Math.floor(o/864e5);return i<1?"الآن":i<60?`منذ ${i} دقيقة`:c<24?`منذ ${c} ساعة`:d<7?`منذ ${d} يوم`:e.toLocaleDateString("ar-EG",{month:"short",day:"numeric"})}async function v(t){if(a)try{const e=n();await e.favorites.get(t.id)||await e.favorites.put({videoId:t.id,title:t.title,thumbnail:t.thumbnail,addedAt:new Date().toISOString()})}catch(e){console.error("Error adding to favorites:",e)}}async function S(t){if(a)try{await n().favorites.delete(t)}catch(e){console.error("Error removing from favorites:",e)}}async function p(t){if(!a)return!1;try{return!!await n().favorites.get(t)}catch{return!1}}async function k(){if(!a)return[];try{return await n().favorites.orderBy("addedAt").reverse().toArray()}catch{return[]}}async function A(t,e="medium"){if(a)try{const r=n();await r.watchLater.get(t.id)||await r.watchLater.put({videoId:t.id,title:t.title,thumbnail:t.thumbnail,addedAt:new Date().toISOString(),priority:e})}catch(r){console.error("Error adding to watch later:",r)}}async function L(t){if(a)try{await n().watchLater.delete(t)}catch(e){console.error("Error removing from watch later:",e)}}async function I(t){if(!a)return!1;try{return!!await n().watchLater.get(t)}catch{return!1}}async function T(){if(!a)return[];try{const t=await n().watchLater.toArray(),e={high:0,medium:1,low:2};return t.sort((r,o)=>{const i=e[r.priority]-e[o.priority];return i!==0?i:new Date(r.addedAt).getTime()-new Date(o.addedAt).getTime()})}catch{return[]}}export{b as a,k as b,T as c,L as d,p as e,D as f,n as g,I as h,a as i,m as j,v as k,A as l,g as m,y as n,h as o,w as p,S as r};
